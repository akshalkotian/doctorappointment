{% extends "base.html" %}

{% block title %}Home - HealthCare Plus{% endblock %}

{% block extra_css %}
<style>
    .selection-card {
        border: 2px solid transparent;
        border-radius: 2rem;
        padding: 2.5rem;
        background: linear-gradient(135deg, white 0%, #F8FBFD 100%);
        box-shadow: 0 8px 24px rgba(111, 180, 214, 0.12);
        transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        position: relative;
        overflow: hidden;
    }
    
    .selection-card::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 2rem;
        padding: 2px;
        background: linear-gradient(135deg, #6FB4D6, #7FD4C1);
        -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        opacity: 0;
        transition: opacity 0.5s;
    }
    
    .selection-card:hover::before {
        opacity: 1;
    }
    
    .selection-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 16px 48px rgba(111, 180, 214, 0.2);
    }
    
    .step-indicator {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(135deg, #6FB4D6 0%, #7FD4C1 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 1.25rem;
        box-shadow: 0 8px 16px rgba(111, 180, 214, 0.3);
        transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .step-indicator:hover {
        transform: scale(1.15) rotate(10deg);
    }
    
    .doctor-card-mini {
        border: 2px solid #E2E8F0;
        border-radius: 1rem;
        padding: 1.25rem;
        margin-bottom: 1rem;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        background: white;
    }
    
    .doctor-card-mini:hover {
        border-color: #6FB4D6;
        background: linear-gradient(135deg, #E3F2F9 0%, #D4F4EC 100%);
        transform: translateY(-3px);
        box-shadow: 0 8px 24px rgba(111, 180, 214, 0.15);
    }
    
    .doctor-card-mini.selected {
        border-color: #7FD4C1;
        background: linear-gradient(135deg, #D4F4EC 0%, #E3F2F9 100%);
        box-shadow: 0 8px 24px rgba(127, 212, 193, 0.2);
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section-modern">
    <div class="container">
        <div class="row align-items-center py-5">
            <div class="col-lg-6 mb-4 mb-lg-0">
                <div class="hero-content">
                    <span class="badge bg-primary-subtle text-primary px-3 py-2 rounded-pill mb-3">
                        <i class="fas fa-sparkles me-1"></i>Trusted Healthcare Platform
                    </span>
                    <h1 class="hero-title display-4 fw-bold mb-4">
                        Find & Book <span class="text-primary">Top Doctors</span> Near You
                    </h1>
                    <p class="hero-subtitle lead text-muted mb-4">
                        Connect with verified healthcare professionals in seconds. Quality healthcare is just a click away.
                    </p>
                    
                    {% if session.user_id %}
                    <!-- Quick Access Buttons for Logged in Users -->
                    <div class="hero-actions mb-4">
                        <a href="{{ url_for('find_doctor') }}" class="btn btn-primary btn-lg rounded-pill px-5 me-3 mb-2">
                            <i class="fas fa-stethoscope me-2"></i>Find My Doctor
                        </a>
                        <a href="{{ url_for('doctors_list') }}" class="btn btn-outline-primary btn-lg rounded-pill px-5 mb-2">
                            <i class="fas fa-search me-2"></i>Browse All Doctors
                        </a>
                    </div>
                    {% else %}
                    <!-- Guest User Actions -->
                    <div class="hero-actions">
                        <a href="{{ url_for('register') }}" class="btn btn-primary btn-lg rounded-pill px-5 me-3 mb-2">
                            <i class="fas fa-user-plus me-2"></i>Create Account
                        </a>
                        <a href="{{ url_for('login') }}" class="btn btn-success btn-lg rounded-pill px-5 mb-2">
                            <i class="fas fa-sign-in-alt me-2"></i>Patient Login
                        </a>
                    </div>
                    <div class="mt-3">
                        <small class="text-muted">
                            Healthcare staff? <a href="{{ url_for('admin_login') }}" class="text-danger fw-bold text-decoration-none">Admin Login <i class="fas fa-arrow-right ms-1"></i></a>
                        </small>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="col-lg-6">
                <div class="hero-image">
                    <img src="https://illustrations.popsy.co/amber/doctor.svg" alt="Doctor Illustration" class="img-fluid">
                </div>
            </div>
        </div>
    </div>
</section>

{% if session.user_id %}
<!-- City → Hospital → Doctor Selection Section -->
<section class="selection-section py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="section-title fw-bold mb-3">Find Your Doctor</h2>
            <p class="text-muted">Select city, hospital, and doctor in 3 simple steps</p>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="selection-card">
                    <form id="selectionForm">
                        <div class="row g-4">
                            <!-- Step 1: Select City -->
                            <div class="col-md-4">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="step-indicator me-3">1</div>
                                    <div>
                                        <h6 class="mb-0 fw-bold">Select City</h6>
                                        <small class="text-muted">Choose your city</small>
                                    </div>
                                </div>
                                <select class="form-select form-select-lg" id="citySelect" required>
                                    <option value="">Choose City...</option>
                                    {% for city in cities %}
                                    <option value="{{ city.id }}">{{ city.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- Step 2: Select Hospital -->
                            <div class="col-md-4">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="step-indicator me-3">2</div>
                                    <div>
                                        <h6 class="mb-0 fw-bold">Select Hospital</h6>
                                        <small class="text-muted">Pick hospital</small>
                                    </div>
                                </div>
                                <select class="form-select form-select-lg" id="hospitalSelect" disabled required>
                                    <option value="">First select city...</option>
                                </select>
                            </div>

                            <!-- Step 3: Go to Doctors -->
                            <div class="col-md-4">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="step-indicator me-3">3</div>
                                    <div>
                                        <h6 class="mb-0 fw-bold">View Doctors</h6>
                                        <small class="text-muted">Browse doctors</small>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary btn-lg w-100" id="viewDoctorsBtn" disabled>
                                    <i class="fas fa-arrow-right me-2"></i>View Doctors
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Or Browse All Doctors -->
                <div class="text-center mt-4">
                    <p class="text-muted mb-2">or</p>
                    <a href="{{ url_for('doctors_list') }}" class="btn btn-outline-secondary btn-lg rounded-pill px-5">
                        <i class="fas fa-th-large me-2"></i>Browse All Doctors Across All Hospitals
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Specializations Section -->
<section class="specializations-section py-5 {% if not session.user_id %}bg-light{% endif %}">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="section-title fw-bold mb-3">Popular Specializations</h2>
            <p class="text-muted">Choose from our wide range of medical specialties</p>
        </div>
        <div class="row g-3">
            <div class="col-6 col-md-3">
                <a href="{{ url_for('find_doctor') if session.user_id else url_for('login') }}" class="specialization-card-modern">
                    <div class="spec-icon">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <div class="spec-name">Cardiology</div>
                </a>
            </div>
            <div class="col-6 col-md-3">
                <a href="{{ url_for('find_doctor') if session.user_id else url_for('login') }}" class="specialization-card-modern">
                    <div class="spec-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="spec-name">Neurology</div>
                </a>
            </div>
            <div class="col-6 col-md-3">
                <a href="{{ url_for('find_doctor') if session.user_id else url_for('login') }}" class="specialization-card-modern">
                    <div class="spec-icon">
                        <i class="fas fa-bone"></i>
                    </div>
                    <div class="spec-name">Orthopedics</div>
                </a>
            </div>
            <div class="col-6 col-md-3">
                <a href="{{ url_for('find_doctor') if session.user_id else url_for('login') }}" class="specialization-card-modern">
                    <div class="spec-icon">
                        <i class="fas fa-baby"></i>
                    </div>
                    <div class="spec-name">Pediatrics</div>
                </a>
            </div>
            <div class="col-6 col-md-3">
                <a href="{{ url_for('find_doctor') if session.user_id else url_for('login') }}" class="specialization-card-modern">
                    <div class="spec-icon">
                        <i class="fas fa-allergies"></i>
                    </div>
                    <div class="spec-name">Dermatology</div>
                </a>
            </div>
            <div class="col-6 col-md-3">
                <a href="{{ url_for('find_doctor') if session.user_id else url_for('login') }}" class="specialization-card-modern">
                    <div class="spec-icon">
                        <i class="fas fa-female"></i>
                    </div>
                    <div class="spec-name">Gynecology</div>
                </a>
            </div>
            <div class="col-6 col-md-3">
                <a href="{{ url_for('find_doctor') if session.user_id else url_for('login') }}" class="specialization-card-modern">
                    <div class="spec-icon">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div class="spec-name">Ophthalmology</div>
                </a>
            </div>
            <div class="col-6 col-md-3">
                <a href="{{ url_for('find_doctor') if session.user_id else url_for('login') }}" class="specialization-card-modern">
                    <div class="spec-icon">
                        <i class="fas fa-tooth"></i>
                    </div>
                    <div class="spec-name">Dentistry</div>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- How It Works Section -->
<section class="how-it-works-section py-5">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="section-title fw-bold mb-3">How It Works</h2>
            <p class="text-muted">Book your appointment in 4 simple steps</p>
        </div>
        <div class="row g-4">
            <div class="col-md-3">
                <div class="how-step-card text-center">
                    <div class="step-number-large mb-3">1</div>
                    <div class="step-icon-large mb-3">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Choose Location</h5>
                    <p class="text-muted small">Select your city and preferred hospital</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="how-step-card text-center">
                    <div class="step-number-large mb-3">2</div>
                    <div class="step-icon-large mb-3">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Find Doctor</h5>
                    <p class="text-muted small">Browse doctors by specialization</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="how-step-card text-center">
                    <div class="step-number-large mb-3">3</div>
                    <div class="step-icon-large mb-3">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Book Slot</h5>
                    <p class="text-muted small">Choose available date and time</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="how-step-card text-center">
                    <div class="step-number-large mb-3">4</div>
                    <div class="step-icon-large mb-3">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Make Payment</h5>
                    <p class="text-muted small">Secure online payment</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
// City → Hospital → Doctor Selection Logic
const citySelect = document.getElementById('citySelect');
const hospitalSelect = document.getElementById('hospitalSelect');
const viewDoctorsBtn = document.getElementById('viewDoctorsBtn');

if (citySelect) {
    citySelect.addEventListener('change', async function() {
        const cityId = this.value;
        
        // Reset hospital select
        hospitalSelect.innerHTML = '<option value="">Loading hospitals...</option>';
        hospitalSelect.disabled = true;
        viewDoctorsBtn.disabled = true;
        
        if (cityId) {
            try {
                // Fetch hospitals for selected city
                const response = await fetch(`/api/hospitals/${cityId}`);
                const hospitals = await response.json();
                
                // Populate hospital dropdown
                hospitalSelect.innerHTML = '<option value="">Select Hospital...</option>';
                hospitals.forEach(hospital => {
                    const option = document.createElement('option');
                    option.value = hospital.id;
                    option.textContent = hospital.name;
                    hospitalSelect.appendChild(option);
                });
                
                hospitalSelect.disabled = false;
            } catch (error) {
                console.error('Error fetching hospitals:', error);
                hospitalSelect.innerHTML = '<option value="">Error loading hospitals</option>';
            }
        } else {
            hospitalSelect.innerHTML = '<option value="">First select city...</option>';
        }
    });

    hospitalSelect.addEventListener('change', function() {
        viewDoctorsBtn.disabled = !this.value;
    });

    // Handle form submission
    document.getElementById('selectionForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const hospitalId = hospitalSelect.value;
        if (hospitalId) {
            window.location.href = `/hospital/${hospitalId}/doctors`;
        }
    });
}
</script>
{% endblock %}
